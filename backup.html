<!DOCTYPE html>
<html lang="en">
    <title>Ego Energy</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <style>
        body,h1,h2,h3,h4,h5,h6 {font-family: "Lato", sans-serif}
        .w3-bar,h1,button {font-family: "Montserrat", sans-serif}
        .fa-anchor,.fa-coffee {font-size:200px}

        .image {
        width: 250px;
        float: left;
        margin: 20px;
        }
        body {
        font-size: small;
        line-height: 1.4;
        text-align: left;
        }

        t1 {
        text-align: right;
        }

        p {
        margin: 0;
        }

        .performance-facts {
        border: 1px solid black;
        margin: 20px;
        float: left;
        width: 280px;
        padding: 0.5rem;
        table {border-collapse: collapse;}
        }
        .performance-facts__title {
        font-weight: bold;
        font-size: 2rem;
        margin: 0 0 0.25rem 0;
        }
        .performance-facts__header {
        border-bottom: 10px solid black;
        padding: 0 0 0.25rem 0;
        margin: 0 0 0.5rem 0;
        p {
            margin: 0;
        }
        }
        .performance-facts__table {
        width: 100%;
        thead tr {
            th,
            td {
            border: 0;
            }
        }
        th,
        td {
            font-weight: normal;
            text-align: left;
            padding: 0.25rem 0;
            border-top: 1px solid black;
            white-space: nowrap;
        }
        td {
            &:last-child {
            text-align: right;
            }
        }
        .blank-cell {
            width: 1rem;
            border-top: 0;
        }
        .thick-row {
            th,
            td {
            border-top-width: 5px;
            }
        }
        }
        .small-info {
        font-size: 0.7rem;
        }

        .performance-facts__table--small {
        @extend .performance-facts__table;
        border-bottom: 1px solid #999;
        margin: 0 0 0.5rem 0;
        thead {
            tr {
            border-bottom: 1px solid black;
            }
        }
        td {
            &:last-child {
            text-align: left;
            }
        }
        th,
        td {
            border: 0;
            padding: 0;
        }
        }

        .performance-facts__table--grid {
        @extend .performance-facts__table;
        margin: 0 0 0.5rem 0;
        td {
            &:last-child {
            text-align: left;
            &::before {
                content: "â€¢";
                font-weight: bold;
                margin: 0 0.25rem 0 0;
            }
            }
        }
        }

        .text-center {
        text-align: center;
        }
        .text-right {
        text-align: right;
        }
        .thick-end {
        border-bottom: 10px solid black;
        }
        .thin-end {
        border-bottom: 1px solid black;
        }
        .nutrient {
            font-weight: bold;
        }
        
    </style>

    <body>
        <div class="w3-row">
            <div class="w3-col m1 w3-center w3-grey">1</div>
            <div class="w3-col m1 w3-center">2</div>
            <div class="w3-col m1 w3-center w3-grey">3</div>
            <div class="w3-col m1 w3-center">4</div>
            <div class="w3-col m1 w3-center w3-grey">5</div>
            <div class="w3-col m1 w3-center">6</div>
            <div class="w3-col m1 w3-center w3-grey">7</div>
            <div class="w3-col m1 w3-center">8</div>
            <div class="w3-col m1 w3-center w3-grey">9</div>
            <div class="w3-col m1 w3-center">10</div>
            <div class="w3-col m1 w3-center w3-grey">11</div>
            <div class="w3-col m1 w3-center">12</div>
        </div>

        <!-- Navbar -->
        <div class="w3-row">
            <!-- <div class="w3-col w3-bar m2 l1 w3-yellow w3-padding-large w3-large w3-left"><p>Margin</p></div>
            <div class="w3-col w3-bar m2 l1 w3-yellow w3-padding-large w3-large w3-right"><p>Margin</p></div> -->
            <!-- <div class="w3-rest"> -->
                <div class="w3-col w3-bar w3-red w3-card w3-left-align w3-large">
                    <a class="w3-bar-item w3-button w3-xlarge">Ego Energy</a>
                    <div class="w3-right w3-hide-small">
                        <a href="/" class="w3-bar-item w3-button w3-padding-large w3-hover-white">Home</a>
                        <a href="#demo.html" class="w3-bar-item w3-button w3-padding-large w3-white">Demo</a>
                    </div>
                </div>
            <!-- </div> -->

            <!-- Navbar on small screens -->
            <div id="navDemo" class="w3-bar-block w3-white w3-hide w3-hide-large w3-hide-medium w3-large">
                <a href="#" class="w3-bar-item w3-button w3-padding-large">Demo</a>
            </div>
        </div>

        <div class="w3-container" style="padding: 0px">
            <div id="nutrition_label" class="w3-container w3-cell w3-quarter w3-mobile">
              <!-- https://codepen.io/chriscoyier/pen/egHEK -->
              <h6>Nutrition Label</h6>
        
              <section class="performance-facts">
                <header class="performance-facts__header">
                  <h1 class="performance-facts__title">Nutrition Facts</h1>
                  <p id="serving_size">Serving Size: 1 scoop</p>
                  <span id="serving_per_container">Serving Per Container: </span>
                  <input type="radio" id="spc30" name="spc" onclick=get_total() value="30" checked>
                  <label for="spc1">30</label>
                  <input type="radio" id="spc60" name="spc" onclick=get_total() value="60">
                  <label for="spc2">60</label>
                  <input type="radio" id="spc90" name="spc" onclick=get_total() value="90">
                  <label for="spc3">90</label><br>
                </header>
                <table class="performance-facts__table">
                  <thead>
                    <tr>
                      <th colspan="3" class="small-info">
                        Amount Per Serving
                      </th>
                      <th colspan="3" class="small-info">
                        <b>% Daily Value*</b>
                      </th>
                    </tr>
                  </thead>
                  <tbody id="nutrition_fact_table"></tbody>
                </table>
        
                <p class="small-info">* Percent Daily Values are based on a 2,000 calorie diet. Your daily values may be higher or lower depending on your calorie needs:</p>
                <p class="small-info">** Percent Daily Values not established</p>estimate
        
              </section>
            </div>
            
            <div id="selection" class="w3-container w3-cell w3-quarter w3-mobile">
              <h6>Selection</h6>
              <div class="w3-dropdown-click">
                <button onclick="onclick_supplement_dropdown()" class="w3-button w3-black">Supplements</button>
                <div id="supplement_drop_menu" class="w3-dropdown-content w3-bar-block w3-border"></div>
        
                <!-- <button onclick="onclick_flavor_dropdown()" class="w3-button w3-black">Flavor</button>
                <div id="flavor_drop_menu" class="w3-dropdown-content w3-bar-block w3-border">
                  <a class="w3-bar-item w3-button">Strawberry</a>
                  <a class="w3-bar-item w3-button">Lemon Lime</a>
                  <a class="w3-bar-item w3-button">Blue Ice</a>
                </div> -->
        
              </div>
            </div>
        
            <div id="editor" class="w3-container w3-cell w3-quarter w3-mobile">
              <h6>Editor</h6>
              <div id="user_mix"></div>
            </div>
        
            <div id="estimate" class="w3-container w3-cell w3-quarter w3-mobile">
              <h6>Estimate</h6>
              <div id="estimate" class="w3-container w3-mobile"></div>
              <!-- <div class="w3-container w3-mobile" style="float:right; border-top:1px solid; width: 75%"></div> -->
            </div>

            <div class="w3-container w3-cell w3-threequarter w3-mobile"></div>
            <div class="w3-container w3-cell w3-quarter w3-mobile">
              <h6>Subtotal</h6>
              <!-- <div id="estimate" class="w3-container w3-mobile"></div> -->
              <div id="estimate_total"  style="float:right">Total: $0.00</div>
            </div>
            </div>
          </div>
    </body>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.2/papaparse.min.js"></script>

    <script>
  

        /************************************
        Changes text to ProperCase
        *************************************
        Example:
          a = "this is a sentence";
          
        Usage:
          a.toProperCase();
          
        Output:
          "This Is A Sentence"
        */
        String.prototype.toProperCase = function () {
          return this.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
        };
      
        /************************************
        Pull data from csv file
        *************************************
        Uses PapaParse to parse data.csv into arrays for the webpage to use
        */
        var supplement_data = [];
        var nootropic_data = [];
        var flavor_data = [];
        var user_cart = [];
        var userinput_mix_id = 0;
      
        Papa.parse('data.csv',{
          header: true,
          newline: "\n",
          delimiter: ",",
          quoteChar: '"',
          dynamicTyping: true,
          download: true,
          complete: function(results){
          
          for (let i=0;i<results.data.length;i++){
            if (results.data[i].type=="supplement"){
              supplement_data.push(results.data[i]);
            }
            else if (results.data[i].type=="nootropic"){
              nootropic_data.push(results.data[i]);
            }
            else {
              flavor_data.push(results.data[i]);
            }
          }
        }
        });
      
        function add_supplement(name){
          // Adds supplement to user's list
          var supplement_list = document.getElementById("user_mix");
      
          var length = supplement_list.children.length;
          let i;
      
          if(!document.getElementById("userinput_mix_id")){
            // x = document.createElement("INPUT");
            x = document.createElement("div");

            // x.type = "text";
            // x.value = "New mix";
            // x.id = "userinput_mix_id";
            // x.onkeyup = function(){};
            // document.getElementById("user_mix").appendChild(x);
            // add_to_checkout();
          }
      
          // First checks if anything is on the list. If there is nothing on the list, then we can confidently add it
          // 1 for yes, 0 for no; initialize yes to enter first supplement
          if (length==0){
            var do_we_add = 1; 
          }
          else{
            var do_we_add = 0;
          }
      
          // Next we check if the item is already on the list. The function goes through each item of the user's list 
          // and compares it to the item to be added. If it's already on the list, we throw an error and break. Otherwise
          // we add it.
          for (i=0; i<length; i++){
      
            // if the name clicked is the same as child i, then we do not add it
            if (name==supplement_list.children[i].localName){
              // if name is on list we do not add it to the list
              do_we_add = 0; 
              error_balloon();
              break;
            }
            else{
              // if name is not on list we add it to the list
              do_we_add = 1;
            }
          }
      
          // To add the item on the list, we pull data from the csv that matches the item.
          // Calls create_supp_container
          //
          // This function calls the item name rather than the item itself because I wanted to avoid making the HTML an object
          if (do_we_add==1){
            var supplement = supplement_data.find(x=>x.name===name);
            create_supp_container(supplement)
          }
        }
      
        function onclick_supplement_dropdown() {
          /*
          Toggles show/hide on click
      
          Has "Search..." in searchbar, calls searchfunction() when entering kestrokes
      
          Populates list with supplement names, each calling the add_supplement(item_name) function
          */
          let x = document.getElementById("supplement_drop_menu");
          x.style.position = "inherit";
          x.style.width = "200%";
          if (x.index == 1){
            x.style.display = "none";
            x.index = 0;
          }
          else {
            x.style.display = "block";
            let y ="<input type='text' placeholder='Search..' id='search_input' onkeyup='search_function()' style='width: 100%'>";
            let i;
            for (i=0; i<=(supplement_data.length-1); i++) {
              y = y + "<p><a onclick=add_supplement('" + supplement_data[i].name + "')>" + supplement_data[i].propername + "</a></p>";
            }
            document.getElementById("supplement_drop_menu").innerHTML = y;
            x.index = 1;
          }
        }
      
        function onclick_cart_dropdown() {
          /*
          Toggles show/hide on click
      
          Has "Search..." in searchbar, calls searchfunction() when entering kestrokes
      
          Populates list with supplement names, each calling the add_supplement(item_name) function
          */
          let x = document.getElementById("cart_drop_list");
          x.style.position = "inherit";
          if (x.index == 1){
            x.style.display = "none";
            x.index = 0;
          }
          else {
            x.style.display = "block";
            x.index = 1;
          }
        }
      
        function onclick_flavor_dropdown() {
          var x = document.getElementById("flavor_drop_menu");
          var y = document.getElementById("supplement_drop_menu");
          if (x.className.indexOf("w3-show") == -1) { 
              x.className += " w3-show";
              y.className = y.className.replace(" w3-show", "");
          } else {
              x.className = x.className.replace(" w3-show", "");
          }
        }
      
        function create_supp_container(supplement) {
          /*
          supp container is the HTML wrapper container for the user's list.
      
          First it checks if a previous container of the same name was created
            If not, it creates one, attaches it to the list, then calls the other functions.
      
            Otherwise it throws an error.
          */  
          if(document.getElementById(supplement.name) == null){
            
            // var theDiv = document.getElementById("<ID_OF_THE_DIV>");
            // var content = document.createTextNode("<YOUR_CONTENT>");
            // theDiv.appendChild(content);


            var supp_container = document.getElementById("user_mix");
            var content = document.createElement("div");
            content.setAttribute("id", supplement.name);
            supp_container.appendChild(content);
      
            create_label(supplement);
            create_qty_label(supplement);
            create_buttons(supplement);
            create_slider(supplement);
            create_info(supplement);
            create_nutrition_label(supplement);
            create_cart_item(supplement);
      
            update_numbers(supplement);
          }
          else{
            alert("supplement exists");
          }
        }
      
        function create_mix_container(mix_data){
          var mix_container = document.createElement("P");
          obj=document.getElementById("cart_drop_list").childNodes;    
          // Enters loop after first item added to list
          // otherwise, obj.length doesn't exist
          
          let index;
      
          // iterate through cart list
          for (i=0; i<obj.length; i++){
      
            // if user mix is same as cart list
            if (mix_data.id==obj[i].id){
              
              mix_data.iter++;
              mix_data.id.replace(/\d+$/, mix_data.iter);
            }
          }
          mix_container.setAttribute("id", mix_data.id);
          mix_container.setAttribute("data", mix_data.data);
          mix_container.setAttribute("className", "w3-bar-item w3-cell w3-container");
          mix_container.setAttribute("style", "padding: 3px");
          document.getElementById("cart_drop_list").appendChild(mix_container);
          
          var q = document.createElement("SPAN");
          q.id=mix_data.id.concat("_cart_label");
          q.innerHTML=mix_data.id;
          mix_container.appendChild(q);
      
          var trash = document.createElement("BUTTON");
          trash.style = ("float: right")
          trash.innerHTML = " âˆ… ";
          trash.onclick = function(){
            for (i=0; i<user_cart.length; i++){
              if (mix_data.id == user_cart[i].id){
                index = i;
                continue;
              }
            }
            user_cart.splice(index,1);
            trash.parentElement.remove();
            while(!document.getElementById("estimate").childNodes){
              document.getElementById("estimate").childNodes
            }
          };
          mix_container.appendChild(trash);
      
          var edit = document.createElement("BUTTON");
          edit.style = ("float: right")
          edit.innerHTML = "edit";
          edit.onclick = function(){
            for (i=0; i<user_cart.length; i++){
              if (mix_data.id == user_cart[i].id){
                index = i;
                continue;
              }
            }
            data = user_cart[index].data;
      
            for (i=0; i<data.length; i++){
              create_supp_container(data[i]);
            }
      
          };
          mix_container.appendChild(edit);
      
        }
      
        function create_label(supplement) {
          supp_container = document.getElementById(supplement.name);
          var q = document.createElement("SPAN");
          q.id=supplement.name.concat("_label");
          q.innerHTML=supplement.propername.concat(": ");
          supp_container.appendChild(q);
        }
      
        function create_qty_label(supplement) {
          supp_container = document.getElementById(supplement.name);
          var x = document.createElement("SPAN");
          x.id=supplement.name.concat("_label_qty");
          x.innerHTML="10 " + supplement.unit;
          supp_container.appendChild(x);
        }
      
        function create_buttons(supplement) {
          supp_container = document.getElementById(supplement.name);
          var info = document.createElement("BUTTON");
          info.style = ("float: right");
          info.innerHTML = " i ";
          info.onclick = function(){
            var x = document.getElementById(supplement.name.concat("_info"));
            if (x.style.display === 'none') {
              x.style.display = 'block';
            } else {
              x.style.display = 'none';
            }
          };
      
          var minus = document.createElement("BUTTON");
          minus.style = ("float: right")
          minus.innerHTML = " - ";
          minus.onclick = function(){
            if (supplement.qty == 0){
              return
            }
            else{
              supplement.qty --;
              document.getElementById(supplement.name.concat("_slider")).value=supplement.qty;
            }  
            update_numbers(supplement);
          };
          
          var plus = document.createElement("BUTTON");
          plus.style = ("float: right")
          plus.innerHTML = " + ";
          plus.onclick = function(){
            if (supplement.qty == document.getElementById(supplement.name.concat("_slider")).max){
              return
            }
            else{
              supplement.qty ++;
              document.getElementById(supplement.name.concat("_slider")).value=supplement.qty;
            }
            
            update_numbers(supplement);
          };
      
          var trash = document.createElement("BUTTON");
          trash.style = ("float: right")
          trash.innerHTML = " âˆ… ";
          trash.onclick = function(){
            supplement.qty = 0;
            update_numbers(supplement);
            get_total();
      
            document.getElementById(supplement.name).remove();
            document.getElementById(supplement.name.concat("_nutrient_fact")).remove();
            document.getElementById(supplement.name.concat("_cart")).remove();
            if (document.getElementById("user_mix").children.length==0){
              document.getElementById("userinput_mix_id").remove();
              document.getElementById("atc").remove();
              document.getElementById("clear_atc").remove();
            }
          };
      
          supp_container.appendChild(plus);
          supp_container.appendChild(trash);
          supp_container.appendChild(minus);
          supp_container.appendChild(info);
        }
      
        function create_slider(supplement) {
          supp_container = document.getElementById(supplement.name);
          supplement.qty = 10;
          var w = document.createElement("div");
          var x = document.createElement("INPUT");
          x.setAttribute("type", "range");
          x.setAttribute("class", "slider");
          x.setAttribute("name", "supplement.name");
          x.setAttribute("min", "0");
          x.setAttribute("value", "10");
          x.setAttribute("max", "500");
          x.setAttribute("id", supplement.name.concat("_slider"));
          x.oninput = function(){
            supplement.qty = Number(this.value);
            update_numbers(supplement)};
          x.style = "width: 100%";
          w.appendChild(x);
          supp_container.appendChild(w);
        }
      
        function create_info(supplement) {
          supp_container = document.getElementById(supplement.name);
          var q = document.createElement("SPAN");
          q.id=supplement.name.concat("_info");
          q.innerHTML="tada";
          q.style.display = "none";
          supp_container.appendChild(q);
          supp_container.appendChild(q);
        }
      
        function create_nutrition_label(supplement) {
          var table = document.getElementById("nutrition_fact_table");
          var row = table.insertRow(0);
          var qty_percent = row.insertCell(0);
          var qty_mass = row.insertCell(0);
          var nutrient = row.insertCell(0);
          
          row.className = "nutrient";
          row.id=supplement.name.concat("_nutrient_fact");
          nutrient.setAttribute("colspan","2");
          qty_mass.setAttribute("id", supplement.name.concat("_mass_qty"));
          qty_percent.setAttribute("id", supplement.name.concat("_percent_qty"));
          
          nutrient.innerHTML = supplement.propername;
          qty_mass.innerHTML = supplement.qty;
      
          nan_check = (supplement.qty / supplement.dv) * 100;
          if (isNaN(nan_check)){
            qty_percent.innerHTML = "N/A*";
      
          }
          else{
            qty_percent.innerHTML = String(nan_check.toFixed(0));
          }
          
          qty_percent.className = "text-right";
          qty_mass.className = "text-right";
        }
        
        function create_cart_item(supplement) {
          
          var cart_container = document.createElement(supplement.name.concat("_cart"));
          cart_container.id=supplement.name.concat("_cart");
          cart_container.className="w3-container";
      
          document.getElementById("estimate").appendChild(cart_container);
      
          var q = document.createElement("SPAN");
          q.id=supplement.name.concat("_cart_label");
          q.innerHTML=supplement.propername.concat(": ");
          
          var x = document.createElement("SPAN");
          x.id=supplement.name.concat("_cart_label_qty");
          x.innerHTML = document.getElementById(supplement.name.concat("_slider")).value;
          x.style.float = "right";
      
          var y = document.createElement("SPAN");
          y.id=supplement.name.concat("_cart_label_unit");
          y.innerHTML = supplement.unit;
          y.style.float = "right";
          y.style.paddingLeft = "2px";
          
          var p = document.createElement("p");
          p.id=supplement.name.concat("_price");
          p.innerHTML=("$/unit: ").concat(supplement.price);
          p.style.textAlign = "right";
          
          var subtot1 = document.createElement("SPAN");
          subtot1.id=supplement.name.concat("_subtotal");
          subtot1.innerHTML.concat((Number(document.getElementById(supplement.name.concat("_slider")).value) * supplement.price).toFixed(2));
          subtot1.style.float = "right";
      
          var subtot2 = document.createElement("SPAN");
          subtot2.innerHTML=("Cost: $");
          subtot2.style.float = "right";
      
          cart_container.appendChild(q);
          cart_container.appendChild(y);
          cart_container.appendChild(x);
          cart_container.appendChild(p);
          cart_container.appendChild(subtot1);
          cart_container.appendChild(subtot2);

          document.getElementById("estimate").appendChild(cart_container);
        }
      
        function get_total(){
          
          obj = document.getElementById("user_mix").childNodes;
          let i = 0;
          let total = 0;
          
          for(i=1;i<obj.length-1;i++){
            x = obj[i].id.concat("_subtotal");
            total+=Number(document.getElementById(x).innerHTML);
          }
      
          s = document.getElementsByName("spc");
          if(s[0].checked){
            document.getElementById("estimate_total").innerHTML=(("Total: $").concat(Number(total*30).toFixed(2)));
          }
          else if(s[1].checked){
            document.getElementById("estimate_total").innerHTML=(("Total: $").concat(Number(total*60).toFixed(2)));
          }
          else{
            document.getElementById("estimate_total").innerHTML=(("Total: $").concat(Number(total*90).toFixed(2)));
          }
        }
      
        function update_numbers(supplement) {
          x = supplement.qty;
      
          y = document.getElementById(supplement.name.concat("_label_qty"));
          y.innerHTML = String(x).concat(" ").concat(supplement.unit);
          
          z = document.getElementById(supplement.name.concat("_mass_qty"));
          z.innerHTML = String(x).concat(" ").concat(supplement.unit);
          
          v = document.getElementById(supplement.name.concat("_cart_label_qty"));
          v.innerHTML = String(x);
      
          w = document.getElementById(supplement.name.concat("_percent_qty"));
          if (supplement.unit == "mg"){
            nan_check = ((supplement.qty / supplement.dv)/1000) * 100;
          }
          else{
            nan_check = (supplement.qty / supplement.dv) * 100;
          }
      
          if (isNaN(nan_check)){
            w.innerHTML = "N/A**";
          }
          else{
            w.innerHTML = String(nan_check.toFixed(0)).concat(" %");
          }
          
          u = document.getElementById(supplement.name.concat("_subtotal"));
          u.innerHTML = (x * supplement.price).toFixed(2);
      
          get_total();
        }
      
        function add_to_checkout(){
          temp = document.getElementById("estimate");
          if(temp.children.length>1){
      
            // var atc = document.createElement("BUTTON");
            // atc.innerHTML = "Add Mix to Cart";
            // atc.onclick = function(){save_mix_to_cart();}
            // atc.id = "atc";
            // document.getElementById("estimate").appendChild(atc);
      
            document.getElementById("clear_atc").remove();
            var clear_atc = document.createElement("BUTTON");
            clear_atc.innerHTML = "Clear Mix";
            clear_atc.onclick = function(){clear_editor();}
            clear_atc.id = "clear_atc";
            document.getElementById("estimate").appendChild(clear_atc);
          }
        }
      
        function save_current_mix(){
      
          obj = document.getElementById("user_mix").childNodes;
          mix_name = document.getElementById("userinput_mix_id");
      
          mix_data = [];
          
          let i = 0;
      
          for (i=0;i<obj.length;i++){
            var supplement = supplement_data.find(x=>x.name===obj[i].id);
            mix_data.push(supplement);
          }
      
          mix_data.id = mix_name;
      
          filename = "export.csv";
      
          var encodedUri = encodeURI(Papa.unparse(mix_data));
      
          var downloadLink = document.createElement("a");
          var blob = new Blob(["\ufeff", Papa.unparse(mix_data)]);
          var url = URL.createObjectURL(blob);
          downloadLink.href = url;
          downloadLink.download = "data.csv";
        }
      
        function save_mix_to_cart(){
          obj = document.getElementById("user_mix").childNodes;
          mix_name = document.getElementById("userinput_mix_id");
      
          mix_data = {};
          data = [];
          let i = 0;
      
          for (i=0;i<obj.length;i++){
            var supplement = supplement_data.find(x=>x.name===obj[i].id);
            data.push(supplement);
          }
          
          var id = mix_name.value;
          mix_data.iter = 0;
          mix_data.id = id.concat("_" + mix_data.iter);
      
          // Check if mix_data.id is valid. mix_data.id must be unique
          for (i=0;i<user_cart.length;i++){
            if (mix_data.id==user_cart[i].id){
              mix_data.iter++;
              a=mix_data.id.replace(/\d+$/, mix_data.iter);
              mix_data.id = a;
            }
            // else{
            //   console.log("butt");
            //   mix_data.iter = i;
            //   mix_data.data = data;
            // }
          }
          mix_data.data = data;
          create_mix_container(mix_data);
          user_cart.push(mix_data);
        }
      
        function clear_editor(){
          while(document.getElementById("user_mix").firstChild){
            document.getElementById("user_mix").removeChild(document.getElementById("user_mix").firstChild);
          }
          while(document.getElementById("estimate").firstChild){
            document.getElementById("estimate").removeChild(document.getElementById("estimate").firstChild);
          }
          while(document.getElementById("nutrition_fact_table").firstChild){
            document.getElementById("nutrition_fact_table").removeChild(document.getElementById("nutrition_fact_table").firstChild);
          }
          document.getElementById("atc").remove();
          document.getElementById("clear_atc").remove();
          document.getElementById("userinput_mix_id").remove();
          get_total();
        }
        
        function clear_cart(){
          while(document.getElementById("estimate").firstChild){
            document.getElementById("estimate").removeChild(document.getElementById("estimate").firstChild);
          }
        }
      
        function clear_nutrition(){
          while(document.getElementById("nutrition_fact_table").firstChild){
            document.getElementById("nutrition_fact_table").removeChild(document.getElementById("nutrition_fact_table").firstChild);
          }
        }
      
        function remove_cart_item(){
          while(document.getElementById("estimate").firstChild){
            document.getElementById("estimate").removeChild(document.getElementById("estimate").firstChild);
          }
        }
      
        function search_function() {
          let input, filter, ul, li, a, i, p;
          input = document.getElementById("search_input");
          filter = input.value.toUpperCase();
          div = document.getElementById("supplement_drop_menu");
          a = div.getElementsByTagName("a");
          for (i = 0; i < a.length; i++) {
            txtValue = a[i].textContent || a[i].innerText;
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
              a[i].style.display = "";
            } else {
              a[i].style.display = "none";
            }
          }
        }
      </script>

</html>
